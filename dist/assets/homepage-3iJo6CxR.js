let d="it",o=null;function s(e){console.log("🌍 Setting language to:",e),d=e,document.querySelectorAll(".lang .chip").forEach(i=>{const c=i.textContent.trim().toLowerCase()===e.toLowerCase();i.setAttribute("aria-selected",c.toString())});const t=document.getElementById("current-lang");t&&(t.textContent=e==="it"?"🇮🇹":"🇺🇸"),typeof translatePage=="function"&&translatePage();const n=document.getElementById("click-hint");n&&(n.textContent=e==="it"?"🎭 Cambia":"🎭 Change");const a=document.querySelector('a[title*="Clicca per cambiare"], a[title*="Click to change"]');a&&(a.title=e==="it"?"🎭 Clicca per cambiare personaggio":"🎭 Click to change character"),typeof updateAuthStatus=="function"&&updateAuthStatus(),window.gameLanguage&&window.gameLanguage.setLanguage(e)}function u(){s(d==="it"?"en":"it")}function l(e=!1){if(console.log("📊 showLeaderboard called, fromProfile:",e),e){typeof closeProfileMenu=="function"&&closeProfileMenu(),window.game&&window.game.scene?window.game.scene.start("LeaderboardScene"):typeof window.startGame=="function"&&(window.startGame(),setTimeout(()=>{var t;(t=window.game)!=null&&t.scene&&window.game.scene.start("LeaderboardScene")},3e3));return}if(window.authManager&&!window.authManager.getState().isAuthenticated){console.log("🔒 Not authenticated, showing auth modal"),o="showLeaderboard",window.homepageAuthModal?window.homepageAuthModal.show():window.AuthModal?(window.homepageAuthModal=new window.AuthModal,window.homepageAuthModal.onAuth(t=>{console.log("✅ Authentication successful, executing pending action:",o),typeof updateAuthStatus=="function"&&updateAuthStatus(),o==="startGame"?r():o==="showLeaderboard"&&l(),o=null}),window.homepageAuthModal.show()):alert(d==="it"?"Per visualizzare la classifica devi prima effettuare il login.":"You need to login first to view the leaderboard.");return}console.log("✅ User authenticated, showing leaderboard"),window.game&&window.game.scene?window.game.scene.start("LeaderboardScene"):typeof window.startGame=="function"&&(window.startGame(),setTimeout(()=>{var t;(t=window.game)!=null&&t.scene&&window.game.scene.start("LeaderboardScene")},3e3))}function g(){l(!0)}function r(){if(console.log("🎮 startGame called"),window.game&&window.game.scene){console.log("🎮 Game already running, checking if MenuScene is active");const n=document.getElementById("homepage"),a=document.getElementById("game-container");n&&(n.style.display="none"),a&&(a.style.display="block"),console.log("🎮 Redirecting to MenuScene to handle game start properly"),window.game.scene.start("MenuScene"),setTimeout(()=>{const i=window.game.scene.getScene("MenuScene");if(i&&i.scene.isActive()){const c=new CustomEvent("homepageStartGame");window.dispatchEvent(c)}},500);return}if(window.authManager&&!window.authManager.getState().isAuthenticated){console.log("🔒 Not authenticated, showing auth modal"),o="startGame",window.homepageAuthModal?window.homepageAuthModal.show():window.AuthModal?(window.homepageAuthModal=new window.AuthModal,window.homepageAuthModal.onAuth(n=>{console.log("✅ Authentication successful, executing pending action:",o),typeof updateAuthStatus=="function"&&updateAuthStatus(),o==="startGame"?r():o==="showLeaderboard"&&l(),o=null}),window.homepageAuthModal.show()):alert(d==="it"?"Per giocare devi prima effettuare il login.":"You need to login first to play.");return}console.log("✅ User authenticated, starting game");const e=document.getElementById("homepage"),t=document.getElementById("game-container");e&&(e.style.display="none"),t&&(t.style.display="block"),!window.game&&typeof window.initializeGame=="function"?window.initializeGame():window.game||console.log("⚠️ Game initialization not available (production mode)")}window.setLanguage=s;window.toggleLanguage=u;window.showLeaderboard=l;window.showLeaderboardFromProfile=g;window.startGame=r;document.addEventListener("DOMContentLoaded",()=>{var t;if(console.log("📱 Homepage JavaScript initialized"),console.log("🌐 Current URL:",window.location.href),console.log("🌐 Expected URL should be etimuebottledropper.netlify.app"),window.location.hostname==="astounding-rolypoly-fc5137.netlify.app"){console.log("🚨 WRONG DOMAIN DETECTED! Redirecting to correct domain..."),window.location.replace("https://etimuebottledropper.netlify.app/");return}const e=localStorage.getItem("language")||((t=navigator.language)!=null&&t.startsWith("it")?"it":"en");s(e)});
