{"version":3,"file":"LeaderboardModal-1941094b-76d6cbda.js","sources":["../../assets/LeaderboardModal-1941094b.js"],"sourcesContent":["var y=Object.defineProperty;var g=(i,e,a)=>e in i?y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a;var n=(i,e,a)=>(g(i,typeof e!=\"symbol\"?e+\"\":e,a),a);import{l as h,s as u,a as p}from\"./index-a7dd0995.js\";import\"./supabase-2481e69c.js\";import\"./phaser-f8c8a439.js\";class w{constructor(){n(this,\"modal\",null);n(this,\"currentView\",\"weekly\");n(this,\"isLoading\",!1);this.createModal(),this.setupEventListeners()}createModal(){this.modal=document.createElement(\"div\"),this.modal.id=\"leaderboard-modal\",this.modal.className=\"leaderboard-modal\",this.modal.style.display=\"none\",this.modal.innerHTML=`\n      <div class=\"leaderboard-modal-backdrop\"></div>\n      <div class=\"leaderboard-modal-content\">\n        <button class=\"leaderboard-close-btn\" id=\"leaderboard-close\">&times;</button>\n\n        <div class=\"leaderboard-header\">\n          <h2 class=\"leaderboard-title\" data-i18n=\"leaderboardTitle\">üèÜ Classifica</h2>\n          <div class=\"leaderboard-tabs\">\n            <button class=\"leaderboard-tab active\" data-tab=\"weekly\" data-i18n=\"leaderboardWeekly\">\n              üìÖ Settimanale\n            </button>\n            <button class=\"leaderboard-tab\" data-tab=\"monthly\" data-i18n=\"leaderboardMonthly\">\n              üìÜ Mensile\n            </button>\n          </div>\n        </div>\n\n        <div class=\"leaderboard-content\">\n          <div class=\"leaderboard-loading\" id=\"leaderboard-loading\">\n            <div class=\"spinner\"></div>\n            <p data-i18n=\"leaderboardLoading\">Caricamento classifica...</p>\n          </div>\n\n          <div class=\"leaderboard-list\" id=\"leaderboard-list\">\n            <!-- Dynamic content -->\n          </div>\n\n          <div class=\"leaderboard-empty\" id=\"leaderboard-empty\" style=\"display: none\">\n            <p data-i18n=\"leaderboardEmpty\">Nessun punteggio ancora registrato!</p>\n            <p class=\"leaderboard-encourage\" data-i18n=\"leaderboardEncourage\">\n              Sii il primo a giocare e stabilire il record!\n            </p>\n          </div>\n        </div>\n\n        <div class=\"leaderboard-footer\">\n          <p class=\"leaderboard-info\" data-i18n=\"leaderboardInfo\">\n            üí° Accedi per competere per i premi settimanali e mensili!\n          </p>\n        </div>\n      </div>\n    `,document.body.appendChild(this.modal)}setupEventListeners(){var d,s,t;const e=(d=this.modal)==null?void 0:d.querySelector(\"#leaderboard-close\");e==null||e.addEventListener(\"click\",()=>this.hide());const a=(s=this.modal)==null?void 0:s.querySelector(\".leaderboard-modal-backdrop\");a==null||a.addEventListener(\"click\",()=>this.hide());const r=(t=this.modal)==null?void 0:t.querySelectorAll(\".leaderboard-tab\");r==null||r.forEach(l=>{l.addEventListener(\"click\",o=>{const c=o.target.getAttribute(\"data-tab\");this.switchTab(c)})}),h.onLanguageChange(()=>{this.updateTranslations()}),document.addEventListener(\"keydown\",l=>{var o;l.key===\"Escape\"&&((o=this.modal)==null?void 0:o.style.display)!==\"none\"&&this.hide()})}updateTranslations(){if(!this.modal)return;const e=h.getTranslation();this.modal.querySelectorAll(\"[data-i18n]\").forEach(a=>{const r=a.getAttribute(\"data-i18n\");r&&r in e&&(a.textContent=e[r])})}switchTab(e){var r;if(this.currentView===e||this.isLoading)return;this.currentView=e;const a=(r=this.modal)==null?void 0:r.querySelectorAll(\".leaderboard-tab\");a==null||a.forEach(d=>{d.classList.remove(\"active\"),d.getAttribute(\"data-tab\")===e&&d.classList.add(\"active\")}),this.loadLeaderboard()}async loadLeaderboard(){if(!(!this.modal||this.isLoading)){this.isLoading=!0,this.showLoading();try{console.log(`üèÜ Loading ${this.currentView} leaderboard...`);let e=[];this.currentView===\"weekly\"?e=await this.getWeeklyLeaderboard():e=await this.getMonthlyLeaderboard(),this.renderLeaderboard(e)}catch(e){console.error(\"Error loading leaderboard:\",e),this.showError()}finally{this.isLoading=!1,this.hideLoading()}}}async getWeeklyLeaderboard(){console.log(\"üìû Calling scoreService.getWeeklyLeaderboard(50)...\");try{const e=await u.getWeeklyLeaderboard(50);return console.log(\"‚úÖ scoreService.getWeeklyLeaderboard completed with:\",e==null?void 0:e.length,\"entries\"),e.map(a=>({id:a.id,score:a.score,run_seconds:a.run_seconds,created_at:a.created_at,nickname:a.nickname||\"Anonimo\",user_id:a.user_id}))}catch(e){throw console.error(\"‚ùå scoreService.getWeeklyLeaderboard failed:\",e),e}}async getMonthlyLeaderboard(){return(await u.getMonthlyLeaderboard(50)).map(a=>({id:a.id,score:a.score,run_seconds:a.run_seconds,created_at:a.created_at,nickname:a.nickname||\"Anonimo\",user_id:a.user_id}))}renderLeaderboard(e){var s;if(!this.modal)return;const a=this.modal.querySelector(\"#leaderboard-list\"),r=this.modal.querySelector(\"#leaderboard-empty\");if(e.length===0){a.style.display=\"none\",r.style.display=\"block\";return}r.style.display=\"none\",a.style.display=\"block\";const d=(s=p.getState().user)==null?void 0:s.id;a.innerHTML=e.map((t,l)=>{const o=l+1,b=d===t.user_id,c=o<=3?this.getMedal(o):`${o}.`,m=new Date(t.created_at).toLocaleDateString(h.getCurrentLanguage()===\"it\"?\"it-IT\":\"en-US\",{month:\"short\",day:\"numeric\",hour:\"2-digit\",minute:\"2-digit\"});return`\n        <div class=\"leaderboard-entry ${b?\"current-user\":\"\"}\">\n          <div class=\"leaderboard-position\">${c}</div>\n          <div class=\"leaderboard-player\">\n            <div class=\"leaderboard-nickname\">${t.nickname}</div>\n            <div class=\"leaderboard-date\">${m}</div>\n          </div>\n          <div class=\"leaderboard-score\">\n            <div class=\"score-value\">${t.score}</div>\n            <div class=\"score-time\">${t.run_seconds}s</div>\n          </div>\n        </div>\n      `}).join(\"\")}getMedal(e){switch(e){case 1:return\"ü•á\";case 2:return\"ü•à\";case 3:return\"ü•â\";default:return`${e}.`}}showLoading(){if(!this.modal)return;const e=this.modal.querySelector(\"#leaderboard-loading\"),a=this.modal.querySelector(\"#leaderboard-list\"),r=this.modal.querySelector(\"#leaderboard-empty\");e.style.display=\"flex\",a.style.display=\"none\",r.style.display=\"none\"}hideLoading(){if(!this.modal)return;const e=this.modal.querySelector(\"#leaderboard-loading\");e.style.display=\"none\"}showError(){if(!this.modal)return;const e=this.modal.querySelector(\"#leaderboard-list\");e.innerHTML=`\n      <div class=\"leaderboard-error\">\n        <p>‚ùå Errore nel caricamento della classifica</p>\n        <button onclick=\"location.reload()\" class=\"retry-btn\">üîÑ Riprova</button>\n      </div>\n    `,e.style.display=\"block\"}show(){this.modal&&(this.modal.style.display=\"flex\",this.updateTranslations(),this.loadLeaderboard(),console.log(\"üèÜ Leaderboard modal opened\"))}hide(){this.modal&&(this.modal.style.display=\"none\",console.log(\"üèÜ Leaderboard modal closed\"))}destroy(){this.modal&&(this.modal.remove(),this.modal=null)}}export{w as LeaderboardModal};\n//# sourceMappingURL=LeaderboardModal-1941094b.js.map\n"],"names":["y","g","n","w","d","s","t","e","a","r","c","h","u","p","b"],"mappings":"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"}